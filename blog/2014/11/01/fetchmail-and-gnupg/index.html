
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fetchmail and GnuPG - joakimbech.com</title>
  <meta name="author" content="Joakim Bech">

  
  <meta name="description" content="When using imap
in mutt you have the
possibility to use gpg to decrypt your password instead of having it as
plaintext in your configuration file (. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jyx.github.io/blog/2014/11/01/fetchmail-and-gnupg">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="joakimbech.com" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46803417-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">joakimbech.com</a></h1>
  
    <h2>The trash can full of ideas</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jyx.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Fetchmail and GnuPG</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-11-01T23:02:03+01:00" pubdate data-updated="true">Nov 1<span>st</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://jyx.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>When using <a href="http://en.wikipedia.org/wiki/Internet_Message_Access_Protocol">imap</a>
in <a href="http://en.wikipedia.org/wiki/Mutt_(email_client)">mutt</a> you have the
possibility to use gpg to decrypt your password instead of having it as
plaintext in your configuration file (.muttrc), see
<a href="https://wiki.archlinux.org/index.php/Mutt#Passwords_management">ArchWiki</a> how
to do that.</p>

<p>However, if you consider using POP3, then you will also need to install and
enable <a href="http://msmtp.sourceforge.net">msmtp</a> (not strictly needed),
<a href="http://www.fetchmail.info">fetchmail</a> and
<a href="http://www.procmail.org">procmail</a>. Ubuntu have created a quite nice
<a href="https://help.ubuntu.com/community/MuttAndGmail">guide</a> of
the steps involved.</p>

<!-- more -->


<p>Just as mutt also msmtp have the possibility to use gpg in runtime instead of
having the password stored in plaintext. The way to do that in msmtp is to put a
line mention gpg in your $HOME/.msmtprc file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>passwordeval    <span class="s2">&quot;gpg --quiet --for-your-eyes-only --no-tty --decrypt ~/.msmtp-gmail.gpg&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, fetchmail doesn&rsquo;t have the same option. So, mutt and msmtp is fine, but
you still have to put your password in a cleartext file when configuring
fetchmail. Clearly there must be a better way to handle this? I downloaded the
source code
(<a href="http://sourceforge.net/projects/fetchmail/files/branch_6.3/fetchmail-6.3.26.tar.xz/download">fetchmail-6.3.26</a>)
and did a quick and dirty hack. I just modified the main function in the file
fetchmail.c, so that instead of having to provide the password on commandline
(when password isn&rsquo;t set in $HOME/.fetchmailrc) it makes use of gpg similar to how
both mutt and msmtp does. It isn&rsquo;t pretty &hellip; but it works (tested on Arch Linux
on a Raspberry PI). To try it out, use the same gpg encrypted file as you use
for msmtp, i.e, $HOME/msmtp-gmail.gpg and patch fetchmail using this patch and
rebuild.</p>

<p>+<figure class='code'><figcaption><span>fetchmail patch  (fetchmail_gpg.patch)</span> <a href='/downloads/code/patch/fetchmail_gpg.patch'>download</a></figcaption></p>

<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'><span class="gh">diff --git a/fetchmail.c b/fetchmail.c</span>
</span><span class='line'><span class="gh">index ae30f90..6462dfe 100644</span>
</span><span class='line'><span class="gd">--- a/fetchmail.c</span>
</span><span class='line'><span class="gi">+++ b/fetchmail.c</span>
</span><span class='line'><span class="gu">@@ -573,6 +573,28 @@ int main(int argc, char **argv)</span>
</span><span class='line'>          ctl-&gt;remotename, ctl-&gt;server.pollname);
</span><span class='line'>      return(PS_AUTHFAIL);
</span><span class='line'>      } else {
</span><span class='line'><span class="gi">+#define ENABLE_GPG_PASSWORD</span>
</span><span class='line'><span class="gi">+#ifdef ENABLE_GPG_PASSWORD</span>
</span><span class='line'><span class="gi">+        FILE *f;</span>
</span><span class='line'><span class="gi">+        f = popen(&quot;/usr/bin/gpg -dq $HOME/.msmtp-gmail.gpg&quot;, &quot;r&quot;);</span>
</span><span class='line'><span class="gi">+        if (f)</span>
</span><span class='line'><span class="gi">+        {</span>
</span><span class='line'><span class="gi">+            tmpbuf = (char *)xmalloc(64);</span>
</span><span class='line'><span class="gi">+            memset(tmpbuf, 0, 64);</span>
</span><span class='line'><span class="gi">+            fgets(tmpbuf, 64, f);</span>
</span><span class='line'><span class="gi">+            pclose(f);</span>
</span><span class='line'><span class="gi">+</span>
</span><span class='line'><span class="gi">+            /* Remove the newline character. */</span>
</span><span class='line'><span class="gi">+            tmpbuf[strlen(tmpbuf)-1] = &#39;\0&#39;;</span>
</span><span class='line'><span class="gi">+            ctl-&gt;password = xstrdup(tmpbuf);</span>
</span><span class='line'><span class="gi">+            /* fprintf(stdout, &quot;pw: %s : %d\n&quot;, ctl-&gt;password, strlen(ctl-&gt;password)); */</span>
</span><span class='line'><span class="gi">+            free(tmpbuf);</span>
</span><span class='line'><span class="gi">+        }</span>
</span><span class='line'><span class="gi">+        else</span>
</span><span class='line'><span class="gi">+        {</span>
</span><span class='line'><span class="gi">+            fprintf(stderr, &quot;No encrypted file at $HOME/.msmtp-gmail.gpg&quot;);</span>
</span><span class='line'><span class="gi">+        }</span>
</span><span class='line'><span class="gi">+#else</span>
</span><span class='line'>      const char* password_prompt = GT_(&quot;Enter password for %s@%s: &quot;);
</span><span class='line'>      size_t pplen = strlen(password_prompt) + strlen(ctl-&gt;remotename) + strlen(ctl-&gt;server.pollname) + 1;
</span><span class='line'>
</span><span class='line'><span class="gu">@@ -580,7 +602,9 @@ int main(int argc, char **argv)</span>
</span><span class='line'>      snprintf(tmpbuf, pplen, password_prompt,
</span><span class='line'>          ctl-&gt;remotename, ctl-&gt;server.pollname);
</span><span class='line'>      ctl-&gt;password = xstrdup((char *)fm_getpassword(tmpbuf));
</span><span class='line'><span class="gi">+        fprintf(stdout, &quot;pw: %s : %d\n&quot;, ctl-&gt;password, strlen(ctl-&gt;password));</span>
</span><span class='line'>      free(tmpbuf);
</span><span class='line'><span class="gi">+#endif</span>
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>     }
</span></code></pre></td></tr></table></div>


<p></figure></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joakim Bech</span></span>

      








  


<time datetime="2014-11-01T23:02:03+01:00" pubdate data-updated="true">Nov 1<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/coding/'>coding</a>, <a class='category' href='/blog/categories/hacking/'>hacking</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://jyx.github.io/blog/2014/11/01/fetchmail-and-gnupg/" data-via="Jyxxan" data-counturl="http://jyx.github.io/blog/2014/11/01/fetchmail-and-gnupg/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/02/02/timing-attack-proof-of-concept/" title="Previous Post: Timing Attack - Proof of Concept">&laquo; Timing Attack - Proof of Concept</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/03/11/aeg-ts-250-k-table-saw/" title="Next Post: AEG TS 250 K - Table Saw review">AEG TS 250 K - Table Saw review &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/11/aeg-ts-250-k-table-saw/">AEG TS 250 K - Table Saw Review</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/01/fetchmail-and-gnupg/">Fetchmail and GnuPG</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/02/timing-attack-proof-of-concept/">Timing Attack - Proof of Concept</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/09/apply-patches-in-git/">Apply Patches in Git</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/04/perl-pack-and-unpack/">Perl Pack and Unpack</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Projects</h1>
  <ul id="projects">
	  <li class='projects'><a href='/bashhelp'>Bash help</a></li>
	  <li class='projects'><a href='/antservo'>Antenna servo</a></li>
	  <li class='projects'><a href='/atschjoo'>ATschjoo</a></li>
	  <li class='projects'><a href='/gengraph'>Gengraph</a></li>
	  <li class='projects'><a href='/globalme'>Global-me</a></li>
	  <li class='projects'><a href='/nimbox'>NIM and Squeezebox</a></li>
	  <li class='projects'><a href='/pakgrep'>Pakgrep</a></li>
	  <li class='projects'><a href='/umlfs'>UML FS</a></li>
	  <li class='projects'><a href='/wolfparser'>Wolfparser</a></li>
  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/tools/'>Tools (1)</a></li>
<li class='category'><a href='/blog/categories/c/'>c (1)</a></li>
<li class='category'><a href='/blog/categories/coding/'>coding (6)</a></li>
<li class='category'><a href='/blog/categories/git/'>git (1)</a></li>
<li class='category'><a href='/blog/categories/hacking/'>hacking (2)</a></li>
<li class='category'><a href='/blog/categories/perl/'>perl (1)</a></li>
<li class='category'><a href='/blog/categories/review/'>review (1)</a></li>
<li class='category'><a href='/blog/categories/woodworking/'>woodworking (1)</a></li>

  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Jyx">@Jyx</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Jyx',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+JoakimBech?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Joakim Bech -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'joakimbech';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jyx.github.io/blog/2014/11/01/fetchmail-and-gnupg/';
        var disqus_url = 'http://jyx.github.io/blog/2014/11/01/fetchmail-and-gnupg/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
